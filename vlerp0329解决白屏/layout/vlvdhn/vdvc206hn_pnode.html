<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>【湖南-企业-市检审核】</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../../css/common/mui.min.css">
		<link rel="stylesheet" href="../../css/index.css">
		<link rel="stylesheet" href="../../css/fonts/iconfont.css" />
		<style type="text/css">
			header{height: 65px !important;}
			header a, header h1{color: #FFFFFF !important;}
			.mui-content{padding-top: 65px !important;}
			.vrac203-search-terms{position: fixed;z-index: 100000000;width:100%;height:120px;background: #EAEAEA;overflow: hidden;}
			label{font-size: 12px;color: #6C6C6C;}
			input{height:30px !important;margin:3px auto !important;padding:2px !important;border:1px solid #5da8fa !important;border-radius:10px !important;font-size: 14px;}
			input[placeholder] {padding:2px !important;font-size: 14px;color: #000;}
		
			.search-terms-txt{padding: 8px 5px;text-align:;}
			.search-terms-title{padding-left:10px}
			.hide {display: none;}
			.order-main-li{margin-bottom:5px;padding:5px 10px !important;background:#fff;border-top:0px solid #E0E0E0; box-shadow: 3px 3px 3px #ccc}
			.order-imgbox{padding:5px;padding-left:0px;box-sizing:border-box;}
			.order-info-title {padding-top:1px;font-size: 14px;color:#242424;text-overflow: ellipsis;white-space: nowrap;overflow: hidden;}
			.order-info-leftbox{}
			.order-info-left {display: -webkit-box;min-height: 14px;margin-bottom:1px;font-size: 12px;line-height: 12px;-webkit-box-orient: vertical;-webkit-line-clamp: 2;overflow: hidden;}
			.order-info-rightbox{text-align: right;}
			.order-info-right {font-size: 12px;line-height: 14px;float: right;margin:1px auto;}
			.order-price{color:#FF5053;font-size: 14px;}
			.order-qty{font-size: 16px;color: #000000;}
			.order-statusbox{text-align:right;padding-right:10px;}
			.order-status {margin-left:10px;font-size: 10px;line-height: 14px;color: #f0ad4e;border: 1px solid #f0ad4e;border-radius: 2px;text-align: center;}
			.detail-label{padding:0px 5px 0px 50px !important;}
			.mui-row:before,
			.mui-row:after,
			.mui-table-view-cell:after,
			.mui-table-view-cell:before{height:0px;}
			.content-total{border-top:1px dashed #C0C0C0}
			.vl-list-search-tip{padding:100px;height:300px;text-align: center;}
			.vl-list-search-tip .icon {color:#353B42;font-size:100px;}
			.vl-list-search-result{color:#000 !important;margin-top:10px;margin-bottom:0;border-bottom: transparent;padding-bottom:0;}
			.vl-list-search-icon{color:#0062cc;height:100px;line-height: 100px;font-size: 100px;}
			.list_sts{padding:3px; font-size:12px;}
			/**/
			.vl-tab-bar{background: #F0F0F0;}
			.vl-tab-item{height: 32px;line-height: 30px;color: #242424;text-align: center;}
			/* .vl-tab-item:hover{background:#EA6D10;color: #FFFFFF;} */
			.vl-tab-item.active{color: #EA6D10;border-bottom: 2px solid #EA6D10;}
			.title {
				margin: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
			}
			
			ul li {
				list-style: none;
			}
			
			.list_font {
				font-size: 10px;
				line-height: 12px;
				height: 12px;
				display: -webkit-box;
				margin-bottom: 5px;
				padding: 0px;
				/*-webkit-box-orient: vertical;*/
				-webkit-line-clamp: 2;
				overflow: hidden;
			}
			
			.list_fonts {
				font-size: 12px;
				line-height: 14px;
			}
			
			.list_h5 {
				font-size: 13px;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
			}
			
			.list_sts {
				font-size: 12px;
				line-height: 14px;
				padding: 3px;
			}
			
			.mui-pull-top-pocket {
				border: transparent;
			}
			.mui-table-view{
				margin-top: 13px;
			}
			.mui-table-view:after {
				height: 0 !important;
			}
			
			.mui-table-view:before {
				height: 0 !important;
			}
			* {
				margin: 0px;
				padding: 0px;
			}
			
			body {
				font-size: 16px;
			}
			
			ul#contList {
				width: 100%;
				background: #efeff4;
			}
			
			ul#contList li {
				margin-bottom: 10px;
			}
			.hide{display: none;}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" id="head" >
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<div class="mui-title plistTitle">
				<p id="TO" style="color: #FFFFFF;">业务人员动态</p>
			</div>		
		</header>
		
		<div class="mui-content">
			
		    <div class="vrac203 vrac203-search vrac203-search-terms">
				<div class="mui-row navBar topNavRow" id="topNav">
					<p class="mui-col-xs-9 topNav active" style="text-align: center;color: #ea6d10;border-bottom: 1px solid #ea6d10;height: 33px;line-height: 33px;" data-task="VR_vdsa402_query_03" data-type="001">拜访列表</p>
					<button id="btn" class="mui-col-xs-2" style="margin-left: 10px;border-radius: 8px;width: 80px;" type="button">拜访轨迹</button>
				</div>
				<div class="mui-row vl-tab-bar" id="J_tabbar"></div>
   				<div class="mui-row">
   					<div class="search-terms-txt mui-col-xs-2">时间:</div>
	   				<div class="search-terms-depts mui-col-xs-4">
							<input id="J_bdate" type="date" class="requiredInput search-date" placeholder="">
			   		</div>
			   		<div class="search-terms-txt mui-col-xs-1">至:</div>
			   		<div class="search-terms-clients mui-col-xs-4">
							<input id="J_edate" type="date" class="requiredInput search-date" placeholder="">
			   		</div>
			   		<div class="search-terms-txt mui-col-xs-1"></div>
   				</div>
	   			<div class="mui-row">
			   		<div class="search-terms-clients mui-col-xs-9 mui-row">
						<div class="search-terms-txt mui-col-xs-2">搜索</div>
		   				<div class="search-terms-depts mui-col-xs-10">
								<input id="J_btn_search" type="text" class="requiredInput" placeholder="">
				   		</div>
					</div>
		   			<div class="mui-col-xs-2" id="J_searchBtn" style="padding-left:10px;box-sizing: border-box !important;">
						<button class="mui-btn-primary mui-btn-outlined">查询</button>
					</div>
					<div class="search-terms-txt mui-col-xs-1"></div>
	   			</div>
		  	</div>
		 
			<!--下拉刷新容器-->
			<div id="pullrefresh" class="vrac203-search vrac203-search-resluts"style="background:;margin:0;padding-top:90px;">
				<div style="position: relative;">
					<div id="showHint" class="vl-list-search-tip hide" style="">
						<span class="icon iconfont icon-wushuju" style=""></span>
						<p class="vl-list-search-result">未查询到相关的数据</p>
						<p >可以尝试其他查询</p>
					</div>
					<div id="J_searching" class="vl-list-search-tip" style="">
						<p class="mui-icon mui-icon-search vl-list-search-icon"></p>
						<p>正在搜索中......</p>
					</div>
					<div id="J_showError" class="vl-list-search-tip hide" style="">
						<span class="icon iconfont icon-kulian" style=""></span>
						<p class="vl-list-search-result">出错啦~</p>
						<p >请稍后再试</p>
					</div>
				</div>
				<div class="mui-scroll" id="content" style="background:;margin:0">
					<ul id="contList" class="mui-table-view mui-table-view-striped mui-table-view-condensed order-main-ul">
					</ul>
				</div>
				<script id="listTmpl" type='text/template'>				
					<li class="mui-table-view-cell" style="height:75px;margin-bottom:3px;padding:10px;background:#fff;">
						<div class="data-row hide"><%=rowdata%></div>
						<div class="mui-slider-cell mui-slider-handle">
							<div class="mui-row">
								<div class="mui-col-xs-9 mui-row" style="background:;height:50px;">
									<h5 class="list_h5 mui-col-xs-12" style="color:#242424;padding-top:3px;"><%=liTitle%></h5>
									<p class="list_font mui-col-xs-12"><%=liLeftT%></p>
									<p class="list_font mui-col-xs-12"><%=liLeftM%></p>
									<p class="list_font mui-col-xs-12">拜访人:<%=liLeftB%></p>
								</div>
								<div class="mui-col-xs-3 mui-row list_three" style="background:;text-align: right;">
									<p class="list_fonts mui-col-xs-12" style="float:right;"><%=liDate%></p>
									<p class="list_fonts mui-col-xs-12" style="float:right;"><button class="mui-btn vl-modify">导航</button></p>
								</div>
							</div>
						</div>
					</li>
				</script>
			</div>
		
		<script src="../../js/mui.min.js" 		type="text/javascript" charset="utf-8"></script>
		<script src="../../js/md5.js" 		type="text/javascript" charset="utf-8"></script>
		<script src="../../js/arttmpl.js" 		type="text/javascript" charset="utf-8"></script>
		<script src="../../js/jquery-2.1.0.js" 	type="text/javascript" charset="utf-8"></script>
		<script src="../../js/vlindex.js" 		type="text/javascript" charset="utf-8"></script>
		<script src="../../js/immersed.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
		;(function(){	
			// 初始化mui
			mui.init({
				pullRefresh: {
					container: '#pullrefresh',
					down: {
						style:'circle',
						callback: pulldownRefresh
					},
					up: {
						auto:false,
						contentrefresh: '正在加载...',
						callback: pullupRefresh
					}
				}
			});
			var totalPage = 0,
			count = 1,
			pageSize = 10,
			activeQtask = "",
			// 渲染页面的数据
			oRenderdata = {'data':[],'pager':{}},
			lastTitle = '';
			var pager={},pageSize=10,activeType="001",activeTask="VR_vdsa402_query_03",count=1
		
			mui.plusReady(function(){
				var self = plus.webview.currentWebview();
				// 基本参数(必要)
				teamBillCom = self.teamBillCom; 
				teamBillComName = self.teamBillComName; 
				fbill_no = self.fbill_no; 
				loginCom = self.loginCom; 
				loginComName = self.loginComName; 
				userbillNo = self.userbillNo; 
				userName = self.userName; 
				privileges = self.privileges; 
				fromPage = self.fromPage;
				search = self.search;
				detailInfo = self.detailInfo;
				document.getElementById('J_bdate').value = detailInfo["日期"].slice(0,10);
				document.getElementById('J_edate').value = detailInfo["日期"].slice(0,10);
				// console.log((JSON.parse(otherParams))['has-status'])
				findData();
			});
			document.getElementById("btn").addEventListener("tap",eBtnmap, false);
			document.getElementById("J_searchBtn").addEventListener("tap",eSearch);
			mui('#contList').on('tap', 'li .vl-modify', function(e) { eaModify(e, this) });
			
			function eaModify(e,self){
				var li = jQuery(self).parents("li");
				dataRow = li.find(".data-row").eq(0).html();
				VlTools.getLocate(sCBgetLocate, eCBgetLocate);
			}
			
			function sCBgetLocate(p){
			 if(plus.os.name ==="Android"){
				 bill_ipaddr = p.coords.longitude;
				 bill_gpsaddr = p.coords.latitude;
				 bill_context =p.addresses
			 }else{
				 var provinces=p.address.province
				 var citys=p.address.city
				 var districts=p.address.district
				 var streets=p.address.street
				 var titles=provinces+citys+districts+streets
				 bill_context =titles
				 bill_ipaddr = p.longitude;
				 bill_gpsaddr = p.latitude;
			 }	
			 window.location.href='http://api.map.baidu.com/direction?origin=latlng:'+bill_gpsaddr+','+bill_ipaddr+'|name:我的位置&destination='+ JSON.parse(dataRow)["指令"] +'&mode=driving&region=中国&output=html&src=webapp.baidu.openAPIdemo'
			}
			
			function eCBgetLocate(e){
			}
			
			function pullupRefresh() {
				setTimeout(function() {
					count++;
					if((count > pager.totalPage)){
					 	mui.toast('没有更多数据了～');
					}else{
					 	findData(count, false)
					
					 }
					mui('#pullrefresh').pullRefresh().endPullupToRefresh();
				}, 1500);
			}
			
			// 下拉刷新具体业务实现
			function pulldownRefresh() {
				document.getElementById("contList").innerHTML = "";
				document.getElementById("J_searching").style.display = "block";
				setTimeout(function() {
					eSearch()
					mui('#pullrefresh').pullRefresh().endPulldownToRefresh(true);
				}, 1500);
			}
			
			function getBEDate() {
				    bdate = document.getElementById("J_bdate").value;
					edate = document.getElementById("J_edate").value;
					bill_bdate = bdate
					bill_edate = edate
				if(bdate == "" || edate == ""){
					mui.toast("请先选择时间段~")
					return false;
				}
				return {
					bdate : bdate + " 00:00:00",
					edate : edate + " 23:59:59",
				}
			}

			function findData(page,type){
			// console.log(searchTask)
				var _date = getBEDate();
				if(!!!_date)return;
				
				var params = {
					bill_task	: activeTask,
					bill_com	: loginCom, 
					bill_user 	: userbillNo,
					bill_qtask	: "Y",
					bill_bdate  : _date.bdate,
					bill_edate  : _date.edate,
					bill_title  : document.getElementById("J_btn_search").value,
					currentPage : arguments[0] ? arguments[0] : 1,
					pageSize  : pageSize,
					paramText : "",
					};
//					console.log(JSON.stringify(params))
				VlAjax.post({
					"port" : "active",
					"headers" : "json",
					"isFirst" : false,
					}, params, sCBFind)
				}
				//成功回调
				function sCBFind(data,type){
				 pager = mui.type(data.page) === 'array' ? data.page[0] : data.page;			 
				 if(data.code==0){
					 var datas=data.data;
					 if(datas.length!=0){
						 document.getElementById("showHint").style.display = "none";
						 document.getElementById("J_searching").style.display = "none";
						 var html='';
						 var contList=document.getElementById("contList")
						 for(var i=0;i<datas.length;i++){
							 var rowd=dataAdapter(datas[i])
							 var source =document.getElementById('listTmpl').innerHTML
							 var render=template.compile(source)
							 html+=render(rowd)
							 if(type&&i==0){
								 contList.innerHTML=''
								 document.getElementById("J_searching").style.display="none"
							 }
						 }
						 jQuery("#contList").append(html);
					 } else {
							document.getElementById("contList").innerHTML = "";
							document.getElementById("J_searching").style.display = "none";
							document.getElementById("showHint").style.display = "block";
			       }
				}
				 plus.nativeUI.closeWaiting();
			}
	
	
			function eSearch(){
				document.getElementById("contList").innerHTML = "";
				document.getElementById("J_searching").style.display = "block";
				document.getElementById("showHint").style.display = "none";
				findData()
			}
            
	       //渲染数据格式
		  	function dataAdapter(data){
		  		 var oData = {};
		  		for(var k in data) {
		  			oData[k.slice(0, 2)] = data[k];
		  		}
		  		var row=JSON.stringify(oData);	
		  //	console.log(JSON.stringify(oData))
		  	    return{
		  			"rowdata" 	: row,
		  			"liTitle" 	: oData["标题"],
		  			"liDate" 	: (oData["日期"]).slice(5, 16),
		  			"liImgName" : "",				 
		  			"liLeftT" 	: oData["指令"],
		  			"liLeftM" 	: oData["图片"],
		  			"liLeftB" 	: JSON.parse(oData["内容"])["姓名"],
		  			"liRightT" : '',
		  			"liRightM" : '',
		  			"liRightB" : ''
		  			  }
		         }
			
		    function eBtnmap(){
		    	      mui.openWindow({
		    				id:'vdvc206hn_edit.html',
		    				url:'vdvc206hn_edit.html',
		    				createNew: true,
		    				extras: {
		    					teamBillCom: teamBillCom, 	
		    					teamBillComName: teamBillComName, 	
		    					fbill_no: fbill_no, 		
		    					loginCom: loginCom, 
		    					loginComName: loginComName, 
		    					userbillNo: userbillNo, 
		    					userName: userName, 
		    					privileges: privileges,
		    				}
		    			})
		    }
			
		})();
		</script>
	</body>

</html>