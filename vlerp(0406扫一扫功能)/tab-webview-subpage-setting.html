<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>setting</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" type="text/css" href="css/common/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="css/fonts/iconfont.css">
		<link rel="stylesheet" type="text/css" href="css/icons-extra.css" />
		<link rel="stylesheet" type="text/css" href="css/common/app.css">
		<style>
			html,body,.mui-content {background:;color:#323232}
			.head-img{
				border-radius: 5px;
			}
			.mui-card ul li span.icon {
				font-size: 18px;
				position: relative;
				bottom:-2px;
				background: ;
			}
			.mui-card ul li span.icon.icon-quanzi, .mui-icon-download{
				color: #007AFF;
			}
			.mui-card ul li span.icon.icon-gouwu, .mui-icon-email{
				color: #FF5053;
			}
			.mui-card ul li span.icon.icon-jifen{
				color: #6641E2;
			}
			.mui-card ul li span.icon.icon-lipin1{
				color: #2AC845;
			}
			.version{
				float: ;
				color: #C0C0C0;
			}
			.mui-card .mui-row{
				text-align: center;
			}
			p.card-bar{
				margin:5px;
			}
			p.card-bar.num{
				font-size: 18px;
			}
			p.card-bar.name{
				font-size: 12px;
			}
			p.card-bar.icon{
				font-size: 20px;
				color:#007AFF;
			}
			p.card-bar.wallet{
				color:#000000;
			}
			.mui-card-header{
				position: relative;
			}
			p.userEQ{
				font-size: 30px;
				position: absolute;
				right:20px;
				top:15px
			}
			.vlel-hide{
				display: none;
			}
		</style>
	</head>

	<body>
		<div class="mui-content">
			<div class="mui-card">
				<div class="mui-card-header mui-card-media linkhref" data-sys="all" data-canOpen="true" data-href="layout/PIM.html">
					<img class="head-img" onerror="this.src='images/defult/vdvc001.png'" />
					<div class="mui-media-body" style="min-height: 34px;">
						<span id="userNames">姓名</span>
						<p id="userDept"></p>
					</div>
					<p class="userEQ icon iconfont icon-erweima"></p>
				</div>
				<div class="mui-card-content" >
					<div class="mui-row">
						<div class="mui-col-xs-3">
							<p class="card-bar num " id="balance">0</p>
							<p class="card-bar name ">余额</p>
						</div>
						<div class="mui-col-xs-3">
							<p class="card-bar num " id="integrals">0</p>
							<p class="card-bar name ">积分</p>
						</div>
						<div class="mui-col-xs-3">
							<p class="card-bar num ">0</p>
							<p class="card-bar name ">优惠券</p>
						</div>
						<div class="mui-col-xs-3 linkhref" data-sys="终端" data-canOpen="true" data-href="balance.html">
							<p class="card-bar icon iconfont icon-qianbao-copy"></p>
							<p class="card-bar name wallet">我的钱包</p>
						</div>
					</div>
				</div>
			</div>
			<div class="mui-card">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell dlmenu" id="dlmenu" data-sys="all" data-canOpen="false" data-href="">
						<a class="mui-navigate-right">
							<span class="mui-icon mui-icon-download"></span>
							操作说明书
						</a>
					</li>
					<li class="mui-table-view-cell linkhref" data-sys="all" data-canOpen="true" data-href="layout/vlvdvc/vdvc203_plist.html">
						<a class="mui-navigate-right">
							<span class="mui-icon mui-icon-email"></span>
							意见反馈
						</a>
					</li>
					<li class="mui-table-view-cell linkhref vlel-hide dlreport" data-sys="all" data-canOpen="true" data-href="layout/vlreport/vrdl001_list.html">
						<a class="mui-navigate-right">
							<span class="mui-icon mui-icon-download"></span>
							报表下载
						</a>
					</li>
					<!-- <li class="mui-table-view-cell linkhref" data-sys="all" data-canOpen="false" data-href="">
						<a class="mui-navigate-right">
							<span class="icon iconfont icon-quanzi"></span>
							圈子
						</a>
					</li>
					<li class="mui-table-view-cell linkhref" data-sys="all" data-canOpen="false" data-href="">
						<a class="mui-navigate-right">
							<span class="icon iconfont icon-gouwu"></span>
							购物
						</a>
					</li>
					<li class="mui-table-view-cell linkhref" data-sys="all" data-canOpen="false" data-href="integral.html">
						<a class="mui-navigate-right">
							<span class="icon iconfont icon-jifen"></span>
							积分商城
						</a>
					</li>
					<li class="mui-table-view-cell linkhref" data-sys="all" data-canOpen="false" data-href="./layout/vlvdeb/vdeb312_plist.html">
						<a class="mui-navigate-right">
							<span class="icon iconfont icon-lipin1"></span>
							已兑换礼品
						</a>
					</li> -->
				</ul>
			</div>
			<div class="mui-card" id="addons" style="display: none;">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell linkhref" data-sys="all" data-canOpen="true" data-href="layout/addons.html">
						<a class="mui-navigate-right">
							<span class="mui-icon mui-icon-person"></span>
							系统管理员
						</a>
					</li>
				</ul>
			</div>
			<div class="mui-card">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell linkhref" data-sys="all" data-canOpen="true" data-href="layout/logout.html">
						<a class="mui-navigate-right">
							<span class="mui-icon mui-icon-gear"></span>
							设置
							<span class="version" id="currentVersion"></span>
						</a>
					</li>
				</ul>
			</div>
		</div>
	</body>
	<script src="js/mui.min.js"></script>
	<script src="js/mui.view.js "></script>
	<script src="js/jquery-2.1.0.js"></script>
	<script src="js/md5.js"></script>
	<script src="js/vlindex.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		mui.init()
		var balance = 0,
			obj = [],
			oprMenu = {
				"企业" : "vlerpbook",
				"经销商" : "clerpbook",
				"终端" : "tlerpbook",
			},
			oprMenuName,
			teamBillCom,teamBillComName,
			userbillNo,userName,userRole,
			loginCom,loginComName,
			privileges,userInfo,fbill_no;
		var aUsers = ['vdvc00100_20171008_1727BF0Q', 'vdvc00100_20170707_0707A007', 'vdvc00100_20171009_0350B1DY'];

		mui.plusReady(function() {
			plus.screen.lockOrientation("portrait-primary"); // 禁止横屏显示
			var oldBack = mui.back;
			mui.back = function(){
			  	plus.runtime.quit();
			  	return;
			}
			userInfo = JSON.parse(VlStore.pGet("user"));
//			console.log(JSON.stringify(userInfo.bill_coppo))
			if(userInfo.com_linkvd_userCom == "终端") {
				mui.toast("正在更新余额...", {
					duration: '10ms'
				});
			}
			oprMenuName = VlStore.pGet("newBillcoppo") + (oprMenu[userInfo.com_linkvd_userCom] || "vlerpbook");

			// 展示当前版本号
			document.getElementById("currentVersion").innerHTML = plus.runtime.version; // 展示当前版本号
			
			// 获取上个页面传过来的参数
			getNewData()
			
			if(!VlUtils.isnull(userbillNo)) {
				mui(".head-img")[0].setAttribute('src', VlAjax.getImgPath(userbillNo));
			};
			document.getElementById("userNames").innerHTML = userName + "("+userInfo.usertel+")";
			
			// 
			var falg = aUsers.indexOf(userbillNo) > -1 ? true : false;
			document.getElementById("addons").style.display = (privileges == "ROOT" && falg) ? "block" : "none";
			mui(".dlreport")[0].style.display = (userInfo.bill_coppo == "vdvc10100_20180612_0101H001") ? "block" : "none";
			// 
			mui(".mui-content").on('tap', '.linkhref', function(e) { eaOpenLInkPage(e, this); });
			document.getElementById("dlmenu").addEventListener("tap", eDlmenu, false);
			if(plus.runtime.appid === "vlerpfc"){
				document.getElementById("dlmenu").style.display = "none";
			}
			//余额查询
			findBalance();
			//积分查询
			findintegrals()
			
		}) // plusready
		function getNewData(){
			teamBillCom 	= VlStore.pGet("newTeamBillCom");
			teamBillComName = VlStore.pGet("newTeamBillComName");
			userbillNo 		= VlStore.pGet("userbillNo");
			userName 		= VlStore.pGet("userName");
			loginCom 		= VlStore.pGet("newLoginCom");
			loginComName	= VlStore.pGet("newLoginComName");
			privileges 		= VlStore.pGet("newPrivileges");
			userRole 		= VlStore.pGet("newUserRole");
			fbill_no		= "";
			userinfo 		= JSON.parse(VlStore.pGet('user'));
		}
		function eDlmenu(e){
			// downloadFile(oprMenuName);
			VlAjaxDl.file(oprMenuName);
		}
		function findintegrals(){
			var queryparems = {
				bill_task: "VR_vdeb312_query_01", // 查询的指令
				bill_com: userInfo.bill_coppo, //当前单位 包头衡阳之类的
				bill_oppo: loginCom,
			};
			VlAjax.post({
				"port":"active",
				"headers":"json",
				"outPath":"layout/login.html"
			}, queryparems, inteScb);
			function inteScb(data, type) {
				if(data.data.length != 0) {
					if(data.data[0]["金额金额"] == undefined || data.data[0]["金额金额"] ==  "undefined"){
						document.getElementById("integrals").innerHTML = 0;
					}else{
						document.getElementById("integrals").innerHTML = Number(data.data[0]["金额金额"]).toFixed(2);
					}
				} else {
					document.getElementById("integrals").innerHTML = 0;
				}
			}
		}
		function findBalance(){
			var p = {
				name: 'msvr',
				bill_task: "VR_query_vdac311_01", // 查询的指令
				bill_com: teamBillCom, // 当前单位
				bill_user: userbillNo, // 当前登陆人
				bill_no: userbillNo, // 当前登陆人
				bill_bflow: "用户应收",
				bill_title: "用户应收",
				currentPage: 1,
				pageSize: 100,
				paramText: ""
			};
			VlAjax.post({
				"port":"active",
				"headers":"json",
				"outPath":"layout/login.html"
			}, p, sCB);
			function sCB(data, type) {
				if(data.data.length != 0) {
					if(data.data[0]["数量可用余额"] == undefined || data.data[0]["数量可用余额"] ==  "undefined"){
						document.getElementById("balance").innerHTML = 0;
					}else{
						document.getElementById("balance").innerHTML = data.data[0]["数量可用余额"];
					}
				} else {
					document.getElementById("balance").innerHTML = 0;
				}
			}
		}
		function eaOpenLInkPage(e, self){
			var li = self;
			var dataSys = li.getAttribute("data-sys"); // 可用范围：all、企业、经销商、终端
			var dataCanOpen = li.getAttribute("data-canOpen"); // 可不可以打开
			var dataHref = li.getAttribute("data-href"); // 没有连接即为未开发
			if(dataSys != "all" && dataSys != userInfo.com_linkvd_userCom){
				plus.nativeUI.toast("～敬请期待～", {
					'verticalAlign': "top"
				});
				return;
			}
			if(dataCanOpen == "false"){
				plus.nativeUI.toast("～敬请期待～", {
					'verticalAlign': "top"
				});
				return;
			}
			if(dataHref == "" || dataHref == undefined || dataHref == null){
				plus.nativeUI.toast("～敬请期待～", {
					'verticalAlign': "top"
				});
				return;
			}
			var scanpage = plus.webview.getWebviewById(dataHref.slice(8));
			if(!VlUtils.isnull(scanpage)){
				plus.webview.hide(scanpage);
				plus.webview.close(scanpage);
			}
			getNewData();
			var urlarr = dataHref.split("/");
			// 打开页面
			mui.openWindow({
				url:dataHref,
				id: urlarr[urlarr.length-1],
				createNew:true,
				extras:{
					teamBillCom 	: teamBillCom ,
					teamBillComName : teamBillComName,
					userbillNo 		: userbillNo,
					userName 		: userName,
					loginCom 		: loginCom,
					loginComName 	: loginComName,
					privileges 		: privileges,
					userRole		: userRole,
				},
			});
		}
	</script>

</html>