<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>员工管理（新建）</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" type="text/css" href="../../css/common/mui.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common/app.css" />
		<link rel="stylesheet" type="text/css" href="../../css/index.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common/mui.picker.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common/mui.dtpicker.css" />
		<style>
			body{
				font-size: 12px;
			}
			
			form {
				margin: 5px 0;
			}
			.mui-row{
				padding:8px;
			}
			.focus-input{
				box-sizing: border-box;
				border:1px solid #40a9ff !important;
				border-radius: 10px !important;
			}
			input[placeholder] {
				font-size: 12px;
			}
			input:hover{
				color:#40a9ff;
			}
			.mui-input-row.lastInput:after{
				height:0;
			}
			#contList li:nth-of-type(odd){
				background:#F0F0F0;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav headerMain editHeader" id="head">
			<a class="mui-action-back mui-pull-left" id="goBack">返回</a>
			<div class="mui-title plistTitle" >
				<p id="title">新增员工</p>
				<h1 id="header" ></h1>	
			</div>
			<a class=" mui-pull-right rightIcon" id="saveBtn" data-loading-text="提交中" >保存</a>	
			<div class="mui-row navBar buttonBars" style="background: #F7F7F7;">
				<span class="mui-col-xs-4 state" id="billState"></span>
				<button type="button" id="deleteBtn" class="mui-col-xs-4" >
					<span class="mui-icon mui-icon-trash" id="deleteIcon" ></span>
					<span >删除</span>
				</button>
				<button  type="button" id="bSendBtn" class="mui-col-xs-4 " >
					<span class="mui-icon mui-icon-upload" id="bSendIcon" ></span>
					<span >送审</span>
				</button>
			</div>
		</header>
		<div class="mui-content" style="padding-top:95px;margin-top:10px;margin-bottom:30px;">
			<div class="mui-input-group" id="linkvdUsercom" style="padding:5px 18px 5px 18px;margin-bottom:5px;position: relative;display:none;">
				<div class="mui-row">
					<span class="mui-col-xs-3" style="color:#ACACB4;">员工标识:</span>
					<span class="mui-col-xs-8" id="bill_no"></span>
					<br/>
					<span class="mui-col-xs-3" style="color:#ACACB4;">fbill_no:</span>
					<span class="mui-col-xs-8" id="fbill_no">ROOT</span>
					<br/>
					<span class="mui-col-xs-3" style="color:#ACACB4;">制单人:</span>
					<span class="mui-col-xs-8" id="bill_user"></span>
					<br/>
					<span class="mui-col-xs-3" style="color:#ACACB4;">制单单位:</span>
					<span class="mui-col-xs-8" id="bill_com"></span>
					<br/>
					<span class="mui-col-xs-3" style="color:#ACACB4;">制单时间:</span>
					<span class="mui-col-xs-8" id="bill_date"></span>
				</div>
			</div>
			<div class="mui-input-group" style="padding:5px 18px 5px 18px;margin-bottom:5px;">
				<div class="mui-row infoItem" style="color:#20B2AA;">
					<span>基础信息：</span>
				</div>
				<div class="mui-input-row">
					<label>员工编码</label>
					<input id="bill_id" type="text" class="mui-input-clear " placeholder="录入员工编码">
				</div>
				<div class="mui-input-row">
					<label>员工姓名</label>
					<input id="bill_name" type="text" class="mui-input-clear requiredInput" placeholder="录入员工姓名">
				</div>
				<div class="mui-input-row">
					<label>员工电话</label>
					<input id="bill_nunit" type="number" class="mui-input-clear " placeholder="录入员工电话">
				</div>
				<div class="mui-input-row ">
					<label>性别</label>
					<input id="bill_unit" type="text" class="" readonly="readonly" placeholder="选择性别">
				</div>
				<div class="mui-input-row ">
					<label>民族</label>
					<input id="bill_wflow" type="text" class="" readonly="readonly" placeholder="录入民族">
				</div>
				<div class="mui-input-row ">
					<label>身份证号</label>
					<input id="bill_bid" type="text" class="mui-input-clear " placeholder="录入身份证号码">
				</div>
				<div class="mui-input-row ">
					<label>籍贯</label>
					<input id="bill_title" type="text" class="mui-input-clear " placeholder="录入籍贯">
				</div>
				<div class="mui-input-row ">
					<label>政治面貌</label>
					<input id="bc4politics" type="text" class="mui-input-clear " placeholder="录入政治面貌">
				</div>
				<div class="mui-input-row lastInput">
					<label>出生年月</label>
					<input id="bill_ndate" type="date" data-options='{}' class="mui-input-clear " readonly="readonly" placeholder="点击选择出生年月">
				</div>
			</div>
			<div class="mui-input-group" style="padding:5px 18px 5px 18px;margin-bottom:5px;">
				<div class="mui-row infoItem" style="color:#20B2AA;">
					<span>入职信息：</span>
				</div>
				<div class="mui-input-row">
					<label>员工性质</label>
					<input id="bill_bno" type="text" class="mui-input-clear " placeholder="录入员工性质">
				</div>
				<div class="mui-input-row ">
					<label>合同类别</label>
					<input id="bill_qtask" type="text" class="mui-input-clear " placeholder="录入合同类别">
				</div>
				<div class="mui-input-row">
					<label>入职时间</label>
					<input id="bill_bdate" type="date" data-options='{}'  class="mui-input-clear requiredInput" placeholder="点击选择入职时间">
				</div>
				<div class="mui-input-row lastInput">
					<label>上班地点</label>
					<input id="bill_context" type="text"  class="mui-input-clear" placeholder="录入上班地点">
				</div>
			</div>
			<div class="mui-input-group" style="padding:5px 18px 5px 18px;margin-bottom:5px;">
				<div class="mui-row infoItem" style="color:#20B2AA;">
					<span>部门及班次信息：</span>
				</div>
				<div class="mui-input-row ">
					<label>员工部门</label>
					<input id="bill_dept" type="text" class="" readonly="readonly" placeholder="点击选择员工部门">
				</div>
				<div class="mui-input-row" style="display:;">
					<label>员工岗位</label>
					<input id="bill_nspec" type="text" class="" readonly="readonly" placeholder="点击选择员工岗位">
				</div>
				<div class="mui-input-row">
					<label>部门类别</label>
					<input id="bill_oppo" type="text" class="" readonly="readonly" placeholder="点击选择部门类别">
				</div>
				<div class="mui-input-row">
					<label>职位</label>
					<input id="bill_coppo" type="text" class="" readonly="readonly" placeholder="点击选择职位">
				</div>
				<div class="mui-input-row">
					<label>职位待遇</label>
					<input id="bill_doppo" type="text" class="" readonly="readonly" placeholder="点击职位待遇">
				</div>
				<div class="mui-input-row">
					<label>员工类别标签</label>
					<!--<label>薪酬部门</label>-->
					<input id="bill_label" type="text" class=""  placeholder="员工类别标签">
				</div>
				<div class="mui-input-row lastInput">
					<label>排班班组</label>
					<input id="bill_spec" type="text" readonly="readonly" class="" placeholder="选择排班班组">
				</div>
			</div>
			<div class="mui-input-group" style="padding:5px 18px 5px 18px;margin-bottom:5px;">
				<div class="mui-row infoItem" style="color:#20B2AA;">
					<span>受教育信息：</span>
				</div>
				<div class="mui-input-row ">
					<label>毕业院校</label>
					<input id="bc0college" type="text" class="" placeholder="录入毕业院校">
				</div>
				<div class="mui-input-row">
					<label>毕业时间</label>
					<input id="bc1date" type="date" data-options='{}'  class="" placeholder="点击选择毕业时间">
				</div>
				<div class="mui-input-row">
					<label>专业</label>
					<input id="bc2major" type="text" class="" placeholder="录入专业">
				</div>
				<div class="mui-input-row lastInput">
					<label>学位</label>
					<input id="bc3degree" type="text" class="" readonly="readonly" placeholder="选择学位">
				</div>
			</div>
			<!-- 点击退出时底部弹出-->
			<div id="sheet1" class="mui-popover mui-popover-bottom mui-popover-action ">
				<!-- 可选择菜单 -->
				<ul class="mui-table-view">
					<li class="mui-table-view-cell" id="sureDelBtn">
						<a>确认</a>
					</li>
				</ul>
				<!-- 取消菜单 -->
				<ul class="mui-table-view">
					<li class="mui-table-view-cell">
						<a href="#sheet1"><b>取消</b></a>
					</li>
				</ul>
			</div>
		</div>
	</body>
	<!--出库扫码-->
	<script src="../../js/mui.min.js"></script>
	<script src="../../js/jquery-2.1.0.js"></script>
	
	<script src="../../js/md5.js"></script>
	<script src="../../js/mui.dtpicker.js"></script>
	<script src="../../js/mui.picker.js"></script>
	<script src="../../js/index.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/immersed.js" type="text/javascript" charset="utf-8"></script>
		

	<script type="text/javascript">
		mui.init({});
		var $$ = jQuery.noConflict();
		var teamBillCom = "";
		var teamBillComName = "";
		var date = new Date();
		var userbillNo = "";
		var loginCom = "";
		var loginComName = "";
		var flagNew = "";
		var onlyCode = "";
		var fbill_no = "";
		var detailInfo = null;
		var hadSend = false;  // 用于判断是否送审
		var flagsave = false; // 用于判断是否保存过 
		var rqsData = "";
		var deptname = "";
		var bill_task = "";
		var mainInfo = {};
		var detailArr = null;
		var newdataInfo = {};
		mui.plusReady(function() {
			
			// TODO 1. 页面上的字段========================
			var  normalData = {
				h : {
					bill_no 	:"",							//主:				// 细:
					fbill_no 	:"",							//主:ROOT?			// 细:?
					bill_user 	:"",							//主:				// 细:
					bill_com 	:"",							//主:				// 细:
					bill_date 	:"",				
				},
				 v : {
					bill_id		: "",	// 编号
					bill_name	: "",	// 姓名
					bill_nunit	: "", 	// 电话
					bill_unit	: "", 	// 性别
					bill_wflow	: "",	// 民族
					bill_bid	: "",	// 身份证号
					bill_title	: "",	// 籍贯
	//				bill_text	: "",	// 0.毕业院校/1.毕业时间/2.专业/3.学位/4.政治面貌
					bill_context: "",	// 
					bill_ndate	: "",	// 出生年月
					bill_nspec	: "",	// 岗位
					bill_bno	: "",	// 性质
					bill_qtask	: "",	// 合同类别
					bill_dept	: "",	// 部门
					bill_spec	: "",	// 班组
					bill_doppo	: "",	// 职位待遇
					bill_coppo	: "",	// 职位
					bill_oppo	: "",	// 部门类别
					bill_bdate	: "",	// 入职时间 // 
					bill_label	: "",	// 员工类别标签
				},
				c : {}
			}
			

			// TODO 2. 接收传过来的参数=============================
			var self = plus.webview.currentWebview();
			// 基本参数(必要)
			teamBillCom 	= self.teamBillCom; 	// 1.管理单位代码
			teamBillComName = self.teamBillComName;	// 2.管理单位名称
			fbill_no 		= self.fbill_no;		// 3.fbill_no是
			loginCom 		= self.loginCom;		// 4.登录人的代码
			loginComName 	= self.loginComName;	// 5.登录人的名称
			userbillNo 		= self.userbillNo;		// 6.登录单位代码
			userName 		= self.userName;		// 7.登录单位名称
			privileges 		= self.privileges;		// 8.当前的权限是
			fromPage 		= self.fromPage;		// 9.从哪个页面来
			// 其他
			flagNew = self.flagNew;
			
			// TODO 3. 基础设置/赋值 
			document.getElementById("header").innerHTML = teamBillComName; 				// 0109修改
			// 判断为新增还是修改
			if(flagNew == "N") { // 修改  
				detailInfo = self.detailInfo;
				mainInfo = detailInfo;
				detailArr = detailInfo;
				
				var bill_task = "d_save";
				var privileges = self.privileges;
				var bill_no = mainInfo.bill_no;
				onlyCode = mainInfo.bill_no; //bill_no字段  
				
				billstate(mainInfo.bill_task);
				setValue(mainInfo,normalData,false); 
				//处理时间字段和bill_text字段
				
				document.getElementById("bc0college").value	 = mainInfo.bill_text.split(";")[0].split(":")[1];
				document.getElementById("bc1date").value	 = mainInfo.bill_text.split(";")[1].split(":")[1];
				document.getElementById("bc2major").value	 = mainInfo.bill_text.split(";")[2].split(":")[1];
				document.getElementById("bc3degree").value	 = mainInfo.bill_text.split(";")[3].split(":")[1];
				document.getElementById("bc4politics").value = mainInfo.bill_text.split(";")[4].split(":")[1];
				document.getElementById("bill_bdate").value	 = mainInfo.bill_bdate.slice(0,10);
				document.getElementById("bill_ndate").value	 = mainInfo.bill_ndate.slice(0,10);
				
				flagsave=true;
				if(mainInfo.bill_task == "L"){
					hadSend = false;
				}
				if(mainInfo.bill_task != "L"){
					hadSend = true;
				}
				rqsData = mainInfo;
				
				document.getElementById("title").innerHTML = "信息编辑";
			} 
			if(flagNew == "Y") { // 新增状态
				onlyCode = getDataCode("vdhr105"); //bill_no字段
				bill_task = "d_new";
				document.getElementById("title").innerHTML = "新增员工";
				document.getElementById("billState").innerHTML = "录入中";
				document.getElementById("bill_date").innerHTML = vlUtils.dateToString(date);
				document.getElementById("bill_no").innerHTML = onlyCode;
				document.getElementById("bill_user").innerHTML = userbillNo;
				document.getElementById("bill_com").innerHTML = teamBillCom;
			}
			// TODO 4. 事件绑定==================================
			setButton(flagsave,hadSend)
			document.getElementById("sureDelBtn").addEventListener("tap", sureDelBtn); 	// 删除：弹出确认菜单之后点击确认
//			document.getElementById("bill_ndate").addEventListener("tap",choiceNDate);
//			document.getElementById("bill_bdate").addEventListener("tap",choiceBDate);
//			document.getElementById("bc1date").addEventListener("tap",choiceBC1Date);
			document.getElementById("bill_dept").addEventListener("tap", function(){
//				VR104find("bill_dept");
				mui.openWindow({
					url: '../vlvdvc/vdvc103_VRfind.html',
					id: "vdvc103_VRfind.html",
					createNew: true,
					extras: {
						teamBillCom 	: teamBillCom, 		// 1.管理单位代码
						teamBillComName : teamBillComName,	// 2.管理单位名称
						fbill_no 		: fbill_no,			// 3.fbill_no是
						loginCom 		: loginCom,			// 4.登录单位代码
						loginComName 	: loginComName,		// 5.登录单位名称
						userbillNo 		: userbillNo,		// 6.登录人的代码
						userName 		: userName,			// 7.登录人的姓名
						privileges 		: privileges,		// 8.当前的权限是
						fromPage 		: "vdhr105_edit.html",			// 9.从哪个页面来
						choice			: "single",
						other			: "bill_dept",
						bill_task		: "VR_find_vdvc103",
						bill_bflow		: "",
					}
				});
			}); 
			document.getElementById("bill_nspec").addEventListener("tap", function(){
				var fbno = document.getElementById("bill_dept").getAttribute("data-no");
				if(vlUtils.isnull(fbno)){
					alert("请先选择部门~");
					return;
				}
				mui.openWindow({
					url: '../vlvdvc/vdvc103_VRfind.html',
					id: "vdvc103_VRfind.html",
					createNew: true,
					extras: {
						teamBillCom 	: teamBillCom, 		// 1.管理单位代码
						teamBillComName : teamBillComName,	// 2.管理单位名称
						fbill_no 		: fbno,			// 3.fbill_no是
						loginCom 		: loginCom,			// 4.登录单位代码
						loginComName 	: loginComName,		// 5.登录单位名称
						userbillNo 		: userbillNo,		// 6.登录人的代码
						userName 		: userName,			// 7.登录人的姓名
						privileges 		: privileges,		// 8.当前的权限是
						fromPage 		: "vdhr105_edit.html",			// 9.从哪个页面来
						choice			: "single",
						other			: "bill_nspec",
						bill_task		: "VR_find_vdvc103_01",
						bill_bflow		: "岗位",
					}
				})
			}); 
			document.getElementById("bill_coppo").addEventListener("tap", function(){
				var boppo = document.getElementById("bill_oppo").getAttribute("data-no");
				if(vlUtils.isnull(boppo)){
					alert("请先选择部门类别~");
					return;
				}
				mui.openWindow({
					url: 'vdhr103_VRfind.html',
					id: "vdhr103_VRfind.html",
					createNew: true,
					extras: {
						teamBillCom 	: teamBillCom, 		// 1.管理单位代码
						teamBillComName : teamBillComName,	// 2.管理单位名称
						fbill_no 		: boppo,			// 3.fbill_no是
						loginCom 		: loginCom,			// 4.登录单位代码
						loginComName 	: loginComName,		// 5.登录单位名称
						userbillNo 		: userbillNo,		// 6.登录人的代码
						userName 		: userName,			// 7.登录人的姓名
						privileges 		: privileges,		// 8.当前的权限是
						fromPage 		: "vdhr105_edit.html",			// 9.从哪个页面来
						choice			: "single",
						other			: "bill_coppo",
						bill_task		: "VR_find_vdhr103_01",
						bill_bflow		: "",
					}
				})
			}); 
			document.getElementById("bill_doppo").addEventListener("tap", function(){
				var boppo = document.getElementById("bill_oppo").getAttribute("data-no");
				if(vlUtils.isnull(boppo)){
					alert("请先选择部门类别~");
					return;
				}
				mui.openWindow({
					url: 'vdhr103_VRfind.html',
					id: "vdhr103_VRfind.html",
					createNew: true,
					extras: {
						teamBillCom 	: teamBillCom, 		// 1.管理单位代码
						teamBillComName : teamBillComName,	// 2.管理单位名称
						fbill_no 		: boppo,			// 3.fbill_no是
						loginCom 		: loginCom,			// 4.登录单位代码
						loginComName 	: loginComName,		// 5.登录单位名称
						userbillNo 		: userbillNo,		// 6.登录人的代码
						userName 		: userName,			// 7.登录人的姓名
						privileges 		: privileges,		// 8.当前的权限是
						fromPage 		: "vdhr105_edit.html",			// 9.从哪个页面来
						choice			: "single",
						other			: "bill_doppo",
						bill_task		: "VR_find_vdhr103_01",
						bill_bflow		: "",
					}
				})
			});
			document.getElementById("bill_oppo").addEventListener("tap", function(){
				mui.openWindow({
					url: 'vdhr103_VRfind.html',
					id: "vdhr103_VRfind.html",
					createNew: true,
					extras: {
						teamBillCom 	: teamBillCom, 		// 1.管理单位代码
						teamBillComName : teamBillComName,	// 2.管理单位名称
						fbill_no 		: fbill_no,			// 3.fbill_no是
						loginCom 		: loginCom,			// 4.登录单位代码
						loginComName 	: loginComName,		// 5.登录单位名称
						userbillNo 		: userbillNo,		// 6.登录人的代码
						userName 		: userName,			// 7.登录人的姓名
						privileges 		: privileges,		// 8.当前的权限是
						fromPage 		: "vdhr105_edit.html",			// 9.从哪个页面来
						choice			: "single",
						other			: "bill_oppo",
						bill_task		: "VR_find_vdhr103",
						bill_bflow		: "",
					}
				})
			});
			document.getElementById("bill_spec").addEventListener("tap", function(){
				VR104find("bill_spec");
			}); 
			// 性别
			document.getElementById("bill_unit").addEventListener("tap",function(){
				var sexArr = [
					{"title": "男"},
					{"title": "女"}
				];
				// 弹框
				plus.nativeUI.actionSheet({
					title: "选择性别",
					cancel: "取消",
					buttons: sexArr
				}, function(e) {
					//商品类型find赋值
					if((e.index - 1) != -1){
						document.getElementById("bill_unit").value = sexArr[(e.index - 1)].title;
					}
				});
			});
			// 民族
			document.getElementById("bill_wflow").addEventListener("tap",function(){
				var minzuArr = [
					{"title":"阿昌族"},{"title":"保安族"},{"title":"白族"},{"title":"布朗族"},{"title":"布依族"},
					{"title":"朝鲜族"},{"title":"达斡尔族"},{"title":"傣族"},{"title":"德昂族"},{"title":"侗族"},
					{"title":"东乡族"},{"title":"独龙族"},{"title":"俄罗斯族"},{"title":"鄂温克族"},{"title":"鄂伦春族"},
					{"title":"高山族"},{"title":"仡佬族"},{"title":"哈尼族"},{"title":"哈萨克族"},{"title":"汉族"},
					{"title":"赫哲族"},{"title":"回族"},{"title":"京族"},{"title":"基诺族"},{"title":"景颇族"},
					{"title":"柯尔克孜族"},{"title":"拉祜族"},{"title":"黎族"},{"title":"傈僳族"},{"title":"珞巴族"},
					{"title":"毛南族"},{"title":"满族"},{"title":"仫佬族"},{"title":"蒙古族"},{"title":"苗族"},
					{"title":"门巴族"},{"title":"纳西族"},{"title":"怒族"},{"title":"普米族"},{"title":"羌族"},
					{"title":"撒拉族"},{"title":"畲族"},{"title":"水族"},{"title":"塔吉克族"},{"title":"塔塔尔族"},
					{"title":"土家族"},{"title":"土族"},{"title":"佤族"},{"title":"维吾尔族"},{"title":"乌孜别克族"},
					{"title":"锡伯族"},{"title":"瑶族"},{"title":"彝族"},{"title":"裕固族"},{"title":"藏族"},{"title":"壮族"}
				];
				// 弹框
				plus.nativeUI.actionSheet({
					title: "选择民族(按首字母排列)",
					cancel: "取消",
					buttons: minzuArr
				}, function(e) {
					//商品类型find赋值
					if((e.index - 1) != -1){
						document.getElementById("bill_wflow").value = minzuArr[(e.index - 1)].title;
					}
				});
			});
			// 政治面貌
			document.getElementById("bc4politics").addEventListener("tap",function(){
				var politicsArr = [
					{"title": "中共党员"},
					{"title": "中共预备党员"},
					{"title": "共青团员"},
					{"title": "群众"},
					{"title": "其他"},
				]
				plus.nativeUI.actionSheet({
					title: "选择政治面貌",
					cancel: "取消",
					buttons: politicsArr
				}, function(e) {
					//商品类型find赋值
					if((e.index - 1) == (politicsArr.length-1)){
						//修改弹出框默认input类型为password 
						mui.prompt('其他','请输入您的政治面貌','vlerp',['取消','确定'],function(e){
							var aa = document.querySelector('.mui-popup-input input').value;
							if (e.index == 1) {
								document.getElementById("bc4politics").value = e.value;
							}
						},'div');
						
					}else if((e.index - 1) != -1){
						document.getElementById("bc4politics").value = politicsArr[(e.index - 1)].title;
					}
				});
			});
			// 出生年月
			jQuery("#bill_bid").blur(function(){
				var idNO = jQuery("#bill_bid").val();
//				var idNO = "522325201807041234";
				var cherkreslut = isCardNo(idNO);
				var nowDate =  new Date();
				var nowYear =  nowDate.getFullYear();
				var nowMonth =  nowDate.getMonth()+1;
				var nowDay =  nowDate.getDay()+1;
//				if(idNO.length == 18){
				if(cherkreslut){
					if(idNO.slice(6,10) > nowYear || Number(idNO.slice(10,12)) > 12 || Number(idNO.slice(12,14)) > 31
					 || idNO.slice(6,10) == 0000 || Number(idNO.slice(10,12)) == 00 || Number(idNO.slice(12,14)) == 00
					){
						jQuery("#bill_ndate").val("");
						alert("身份证出生日期不合法"); 
						return;
					}else if(idNO.slice(6,10) == nowYear && Number(idNO.slice(10,12)) > nowMonth ){
						jQuery("#bill_ndate").val("");
						alert("身份证出生日期的月份不合法"); 
						return;
					}else if(idNO.slice(6,10) == nowYear && Number(idNO.slice(10,12)) == nowMonth && Number(idNO.slice(12,14)) > nowDay){
						jQuery("#bill_ndate").val("");
						alert("身份证出生日期的日期不合法"); 
						return;
					}
					var birth = idNO.slice(6,10) + "-" + idNO.slice(10,12) + "-" + idNO.slice(12,14);
					jQuery("#bill_ndate").val(birth);
				}
			});
			// 学位 bc3degree
			document.getElementById("bc3degree").addEventListener("tap",function(){
				var degreeArr = [
					{"title": "学士"},
					{"title": "硕士"},
					{"title": "博士"}
				]
				// 弹框
				plus.nativeUI.actionSheet({
					title: "选择性别",
					cancel: "取消",
					buttons: degreeArr
				}, function(e) {
					//商品类型find赋值
					if((e.index - 1) != -1){
						document.getElementById("bc3degree").value = degreeArr[(e.index - 1)].title;
					}
				});
			});
			//
			mui("body").on('tap', 'input', function(e){
				var e = this;
				var li = e.parentNode; //firstChild
				jQuery(e).parent().addClass("focus-input").siblings().removeClass("focus-input");
			});
			// TODO 5. 监听自定义事件=============================
			window.addEventListener('vdhr104SelecteDept', function(event) {
				var linkName = event.detail.linkName;
				var linkCom = event.detail.linkCom;
				var deptid = event.detail.other;
				var dataRow = event.detail.dataRow;
				var dataRow = JSON.parse(dataRow);
				document.getElementById(deptid).value = linkName;
//				document.getElementById("bill_spec").value = linkName;
				return;
			});
			// 选择负责人 bill_wflow
			window.addEventListener('vdvc103VRfindselectedDept', function(event) {
				var linkName = event.detail.linkName;
				var linkCom = event.detail.linkCom;
				var deptid = event.detail.other;
				var dataRow = event.detail.dataRow;
				var dataRow = JSON.parse(dataRow);
				document.getElementById(deptid).value = linkName;
				document.getElementById(deptid).setAttribute("data-no",linkCom);
//				document.getElementById("bill_spec").value = linkName;
				return;
			});
			// 部门类别/职位/职位待遇
			window.addEventListener('vdhr103SelectDeptType', function(event) {
				var linkName = event.detail.linkName;
				var linkCom = event.detail.linkCom;
				var domid = event.detail.domid;
				var dataRow = event.detail.dataRow;
				var dataRow = JSON.parse(dataRow);
				document.getElementById(domid).value = linkName;
				document.getElementById(domid).setAttribute("data-no",linkCom);
			});
			// TODO 6. 事件/方法=================================
			// 保存指令
			function saveBtn(){ 
				plus.nativeUI.showWaiting();//这里是开始显示原生等待框
				var checkResults = checkRequiredItems();//验证是否为必填字段  
				if(checkResults == false){
					plus.nativeUI.closeWaiting();//这里监听页面是否加载完毕，完成后关闭等待框
					return false;
				}
				
				rqsData = getValue(normalData,false); //获取每一个输入框的值的方法  
				var bc0college 	= document.getElementById("bc0college").value;
				var bc1date 	= document.getElementById("bc1date").value;
				var bc2major 	= document.getElementById("bc2major").value;
				var bc3degree 	= document.getElementById("bc3degree").value;
				var bc4politics = document.getElementById("bc4politics").value;
				rqsData.bill_text = "毕业院校:"+bc0college+";毕业时间:"+bc1date+";专业:"+bc2major+";学位:"+bc3degree+";政治面貌:"+bc4politics;
				rqsData.bill_bdate = rqsData.bill_bdate + " 00:00:00";
				rqsData.bill_ndate = rqsData.bill_ndate + " 00:00:00";
				newdataInfo = vlUtils.deepCopy(rqsData,newdataInfo);
				if(flagNew == "N") {  flagsave = true; };
				if(flagsave){
				 	rqsData = vlUtils.compareData(mainInfo, rqsData,false);
					rqsData.bill_task = "d_save";
				}else{
					rqsData.bill_task = "d_new";
				}
				CRUDajax(rqsData,"../login.html",saveSuccess);
				return true;
			}
			// 送审指令
			function bSendBtn(){ 
				plus.nativeUI.showWaiting();//这里是开始显示原生等待框
				var sendParams = taskParam("b_send");
				if(!saveBtn()){
					return;
				}
				CRUDajax(sendParams,"../login.html",sendSuccess); 
			}
			// 删除按钮主表
			function deleteBtn(){ 
				mui('#sheet1').popover('show', document.getElementById("deleteBtn"));
			}
			
			// 确认删除主表
			function sureDelBtn(){ 
				var delparams = taskParam("d_delete");
				CRUDajax(delparams,"../login.html",delSuccess);//删除方法 
			} 
			// 确认删除明细
			// 删除/送审的参数
			function taskParam(task){
				var fbillNo = document.getElementById("fbill_no").innerHTML;
				var params = JSON.parse(JSON.stringify(sendTaskData));
				var date = new Date();
				params.bill_task = task;
				params.bill_no 	 = onlyCode;
				params.fbill_no  = fbillNo;
				params.bill_user = userbillNo;
				params.bill_com	 = loginCom;
				params.bill_date = vlUtils.dateToString(date);
				return params;
			}
			function saveSuccess(){
				plus.nativeUI.closeWaiting();//这里监听页面是否加载完毕，完成后关闭等待框
				flagsave = true;
				setButton(flagsave,hadSend)
				mainInfo = vlUtils.deepCopy(rqsData,mainInfo);
				var date = new Date();
				var changeStateparams = { 
					name		: "msvr",
					bill_task		: "VE_vdhr105_01",								// 结账指令   	
					bill_no		: document.getElementById("bill_no").innerHTML,		// 要结哪个仓库的账
					bill_com		: teamBillCom,										// 操作人单位
					bill_user		: userbillNo,										// 操作人代码
					bill_date		: vlUtils.dateToString(date)						// 当前时间
				};
//				// 提交
				CRUDajax(changeStateparams,"../login.html",afterSave);
			}
			function afterSave(){}
			function sendSuccess(){
				plus.nativeUI.closeWaiting();//这里监听页面是否加载完毕，完成后关闭等待框
				hadSend = true;
				setButton(mainInfo);
				mui.openWindow({
					id: 'vdhr105_node.html',
					url: 'vdhr105_node.html',
					createNew: true, 
					extras: { 
						teamBillCom 	: teamBillCom, 		// 1.管理单位代码 	// 不变
						teamBillComName : teamBillComName,	// 2.管理单位名称	// 不变
						fbill_no 	  	: fbill_no,			// 3.fbill_no是		// 不变
						loginCom 		: loginCom,			// 4.登录人的代码
						loginComName 	: loginComName,		// 5.登录人的名称
						userbillNo 		: userbillNo,		// 6.登录单位代码
						userName 		: userName,			// 7.登录单位名称
						privileges 		: privileges,		// 8.当前的权限是
						fromPage 		: "vdhr105_edit.html",		// 9.从哪个页面来
						rqsData			: newdataInfo,//TODO
					}
				}); 
			}
			function delSuccess(){
				successFun("vdhr105_plist.html","vdhr105_list.html");
			}
			//
			function setButton(flagsave,hadSend){
				// 1.
				if(!flagsave){
					document.getElementById("saveBtn").addEventListener("tap",saveBtn); 
					document.getElementById("bSendBtn").addEventListener("tap",bSendBtn);
			   		document.getElementById("deleteBtn").removeEventListener("tap",deleteBtn);
			   		// 
			   		document.getElementById("saveBtn").style.color =  "#FFF"; 
					document.getElementById("bSendIcon").style.color =  "#18B4ED";
			   		document.getElementById("deleteIcon").style.color =  "#8f8f94";
				}
				// 2.
				if(flagsave && !hadSend){
					document.getElementById("saveBtn").addEventListener("tap",saveBtn); 
					document.getElementById("bSendBtn").addEventListener("tap",bSendBtn);
			   		document.getElementById("deleteBtn").addEventListener("tap",deleteBtn);
			   		//
			   		document.getElementById("saveBtn").style.color =  "#FFF";
					document.getElementById("bSendIcon").style.color =  "#18B4ED";
			   		document.getElementById("deleteIcon").style.color =  "#18B4ED";
				}
				// 3.
				if(flagsave && hadSend){
					document.getElementById("saveBtn").removeEventListener("tap",saveBtn); 
					document.getElementById("bSendBtn").removeEventListener("tap",bSendBtn);
			   		document.getElementById("deleteBtn").removeEventListener("tap",deleteBtn);
			   		//
			   		document.getElementById("saveBtn").style.color =  "#8f8f94";
					document.getElementById("bSendIcon").style.color =  "#8f8f94";
			   		document.getElementById("deleteIcon").style.color =  "#8f8f94";
				}
			}
//			function choiceNDate(){
//				dataPicker("bill_ndate");
//			}
//			function choiceBDate(){
//				dataPicker("bill_bdate");
//			}
//			function choiceBC1Date(){
//				dataPicker("bc1date");
//			}
			function billstate(task){
				if(task == "S") {
					document.getElementById("billState").innerHTML = "待审核";
				}
				if(task == "Y") {
					document.getElementById("billState").innerHTML = "已审核";
				}
				if(task == "L"){
					document.getElementById("billState").innerHTML = "待送审";
				}
			}
			//
			function addDetail(){
				saveBtn();
				mui.openWindow({
					url: 'vdhr105_dedit.html',
					id: "vdhr105_dedit.html",
					createNew: true,
					extras: {
						teamBillCom 	: teamBillCom, 		// 1.管理单位代码	// 不变
						teamBillComName : teamBillComName,	// 2.管理单位名称	// 不变
						fbill_no 		: document.getElementById("bill_no").innerHTML,			// 3.fbill_no是		// 不变
						loginCom 		: loginCom,			// 4.登录人的代码
						loginComName 	: loginComName,		// 5.登录人的名称
						userbillNo 		: userbillNo,		// 6.登录单位代码
						userName 		: userName,			// 7.登录单位名称
						privileges 		: privileges,		// 8.当前的权限是
						fromPage 		: "vdhr105_edit.html",			// 9.从哪个页面来
						detailInfo		: "",
						flagNew			: "Y",				// N为修改 ; Y为新增 ,
						bill_wflow		: document.getElementById("bill_wflow").value
					}
				})
			}
			// 校验身份证号码
			function isCardNo(card) { 
				// 身份证号码为15位或者18位，15位时全为数字，18位前17位为数字，最后一位是校验位，可能为数字或字符X 
				var reg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/; 
				if(reg.test(card) === false) { 
					alert("身份证输入不合法"); 
					return false; 
				} else{
					return true;
				}
			}
			function VR104find(id){
				mui.openWindow({
					url: 'vdhr104_VRfind.html',
					id: "vdhr104_VRfind.html",
					createNew: true,
					extras: {
						teamBillCom 	: teamBillCom, 		// 1.管理单位代码
						teamBillComName : teamBillComName,	// 2.管理单位名称
						fbill_no 		: fbill_no,			// 3.fbill_no是
						loginCom 		: loginCom,			// 4.登录单位代码
						loginComName 	: loginComName,		// 5.登录单位名称
						userbillNo 		: userbillNo,		// 6.登录人的代码
						userName 		: userName,			// 7.登录人的姓名
						privileges 		: privileges,		// 8.当前的权限是
						fromPage 		: "vdhr105_edit.html",			// 9.从哪个页面来
						choice			: "single",
						other			: id,
						bill_task		: "VR_find_vdhr104_1",
					}
				})
			}
			
			function cherkphoneNum(){
				document.getElementById("bill_nunit").value;
				var phoneNum = checkMobile(document.getElementById("bill_nunit").value);
				if(phoneNum == '' || phoneNum == false || typeof(phoneNum) == Number) {
					return false;
				}else{
					return true;
				}
			}
		}); // plusReady
		
	</script>

</html>