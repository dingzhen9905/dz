<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" type="text/css" href="../../css/common/mui.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common/app.css" />
		<link rel="stylesheet" type="text/css" href="../../css/index.css" />
		<link rel="stylesheet" type="text/css" href="../../css/fonts/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common/mui.picker.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common/mui.poppicker.css" />
		<style>

			/*关联状态*/
			.list_sts{
				font-size: 12px;
				line-height: 14px;
				color:#f0ad4e;
				border:1px solid #f0ad4e;
				border-radius: 2px;
				text-align: center;
			}
			.bottomLine{
				border-bottom: 1px solid #8f8f94;
				position:relative;
				margin: 25px 50px;
			}
			.end{
				position:absolute;
				top:-8px;
				left:32%;
				background: #efeff4;
				padding:0 10px;
				z-index:111;
				font-size: 10px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav headerMain nodeHeader" id="head">
			<a class="mui-icon mui-action-back mui-icon-left-nav mui-pull-left" id="goBack"></a>
			<h1 class="mui-title headText" id="header"></h1>
			<a class="mui-icon mui-icon-compose mui-pull-right" id="toEdit"></a>		
			<div class="mui-row  navBar nodeTopNav">
				<p class="mui-col-xs-2" id="moveDept">
					<a class="icon iconfont icon-migrate"></a>
					<span>部门迁移</span>
				</p>
				<p class="mui-col-xs-2" id="lowerDept">
					<a class="icon iconfont icon-xiajibumen"></a>
					<span>下级部门</span>
				</p>
				<p class="mui-col-xs-2" style="display: none;">
					<a class="icon iconfont icon-gangweiguanli unclickable"></a>
					<span>岗位管理</span>
				</p>
				<p class="mui-col-xs-2" id="CRM">
					<a class="icon iconfont icon-kehu"></a>
					<span>我的客户</span>
				</p>
				<p class="mui-col-xs-2" style="display: none;">
					<a class="icon iconfont icon-xinjinyuangongdengji unclickable"></a>
					<span>员工登记</span>
				</p>
				<p class="mui-col-xs-2" id="userManage">
					<a class="icon iconfont icon-yonghu" ></a>
					<span>我的用户</span>
				</p>
				<p class="mui-col-xs-2" id="chatBtn">
					<a class="icon iconfont icon-fasongxinxi unclickable" id="chatIcon"></a>
					<span id="chatText">发送信息</span>
				</p>
				<p class="mui-col-xs-2" id="bBackBtn">
					<a class="mui-icon mui-icon-paperclip"  id="bBackIcon"></a>
					<span>收回单据</span>
				</p>
			</div>
		</header>
		<!---->
		<div class="mui-content mainBody nodeBody">
			<div class="mui-input-group groupInfo">
				<div class="mui-row infoItem" style="display:none;">
					<span class="mui-col-xs-4" >上级部门：</span>
					<span class="mui-col-xs-8"  id="fbill_no"></span>
				</div>
				<div class="mui-row infoItem lastItem">
					<span class="mui-col-xs-4">上级部门：</span>
					<span class="mui-col-xs-8"  id="fbill_no_name"></span>
				</div>
			</div>
			<div class="mui-input-group groupInfo">
				<div class="mui-row basicInfo">
					<div class="mui-col-xs-2 imgFrame">
						<img class="vdvc105" id="userImg" src="../../images/icon/default.png" />
					</div>
					<div class="mui-col-xs-9 mui-row mui-pull-right infoFrame">
						<div class="mui-col-xs-12 mui-row infoItem">
							<span class="mui-col-xs-3">部门编码：</span>
							<span class="mui-col-xs-5" id="bill_id"></span>
							<span class="mui-col-xs-2 dataState mui-pull-right" id="bill_task"></span>
						</div>
						<div class="list_font mui-col-xs-12  mui-row  infoItem">
							<span class="mui-col-xs-3">部门名称：</span>
							<span class="mui-col-xs-9" id="bill_name"></span>
						</div>
					</div>
				</div>
				<div class="mui-row infoItem" style="border-bottom:1px solid #efeff4;">
					<span class="mui-col-xs-4">部门类别：</span>
					<span class="mui-col-xs-8"  id="bill_bflow"></span>
				</div>
				<div class="mui-row infoItem" style="">
					<span class="mui-col-xs-4">部门类型：</span>
					<span class="mui-col-xs-8"  id="bill_title"></span>
				</div>
				<div class="mui-row infoItem lastItem" style="">
					<span class="mui-col-xs-4">部门标签</span>
					<span class="mui-col-xs-8"  id="bill_label"></span>
				</div>
				<div class="mui-row infoItem" style="position: relative;display: none;">
					<span class="mui-col-xs-4">负责人：</span>
					<span class="mui-col-xs-8"  id="linkvd_linkuser"></span>
					<button type="button" id="changeUser" class="mui-btn mui-btn-primary mui-btn-outlined" style="padding:1px 5px 0 5px;position: absolute;right:10px;top:5px;">变更负责人</button>
				</div>
				<div class="mui-row infoItem lastItem" style="display: none ;">
					<span class="mui-col-xs-4">负责人手机号：</span>
					<span class="mui-col-xs-8"  id="linkbd_linktel"></span>
				</div>
			</div>
			<!--
            	时间：2017-11-18
            	描述：定编人数、实际人数暂时不用，不要删！！！！！
            -->
			<div class="mui-input-group groupInfo" style="display:none;">
				<div class="mui-row infoItem">
					<span class="mui-col-xs-4">定编人数：</span>
					<span class="mui-col-xs-8"  id=""></span>
				</div>
				<div class="mui-row infoItem lastItem">
					<span class="mui-col-xs-4">实际人数：</span>
					<span class="mui-col-xs-8"  id=""></span>
				</div>
			</div>
			<div class="mui-input-group groupInfo">
				<div class="mui-row infoItem">
					<span class="mui-col-xs-4">制单人：</span>
					<span class="mui-col-xs-8"  id="bill_userName"></span>
				</div>
				<div class="mui-row infoItem" style="display:none;">
					<span class="mui-col-xs-4">制单人代码：</span>
					<span class="mui-col-xs-8"  id="bill_user"></span>
				</div>
				<!--<div class="mui-row infoItem">
					<span class="mui-col-xs-4 spn">抄送：</span><span class="mui-col-xs-8 spn" id="cc_user"></span>
				</div>
				<div class="mui-row infoItem" style="display: none;">
					<span class="mui-col-xs-4 spn">抄送：</span><span class="mui-col-xs-8 spn" id="cc_user_code"></span>
				</div>-->
				<div class="mui-row infoItem lastItem">
					<span class="mui-col-xs-4">制单时间：</span>
					<span class="mui-col-xs-8"  id="bill_date"></span>
				</div>
			</div>
			<div class="mui-input-group groupInfo" id="cc" style="padding:5px 18px 5px 18px;margin-bottom:5px;">
				<div class="mui-row infoItem lastItem" style="color:#0062CC;">
					<span class="mui-col-xs-4 spn">抄送：</span>
					<span class="mui-icon mui-icon-plusempty" style="float:right;padding-top:5px;font-weight: bold;"></span>
 					<span class="mui-col-xs-6 spn" id="cc_user_cn" style="color: #8F8F94;"></span>
				</div>
				<div class="mui-row infoItem" style="display: none;">
					<span class="mui-col-xs-4 spn">抄送id：</span>
					<span class="mui-icon mui-icon-plusempty" id="" style="float:right;padding"></span>
					<span class="mui-col-xs-6 spn" id="cc_user_code" style="display: ; overflow: hidden;"></span>
					 
				</div>
			</div>
			<div>
		        <p id="" class="mui-h5" style="font-size: 12px;border-bottom: 1px solid #C0C0C0;margin:0 25px 10px 18px;">部门负责人信息：<span class='state' id=""></span></p>
		        <div class="fold" id="fold">
		        	<p id="" class="mui-h5" style="padding-left:18px;font-size: 12px;">关联编码：<span class='state' id="linkbd_linkid"></span><span></span></p>
		        	<p id="" class="mui-h5" style="padding-left:18px;padding-right:25px;font-size: 12px;">
		        		关联用户：
		        		<span class='state mui-col-xs-4' id="linkuser"></span>
		        		<span class="mui-col-xs-2 dataState mui-pull-right" id="linkbd_linksts" style="margin-top: 0;display: none;"></span>
		        	</p>
		        </div>
			</div>
			<div class="bottomLine" style="">
				<p class="end" style="">没有更多数据了！</p>
			</div>
		</div>
	</body>
	<script src="../../js/mui.min.js"></script>
	<script src="../../js/jquery-2.1.0.js"></script>
	<script src="../../js/md5.js"></script>
	<script src="../../js/index.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/immersed.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		mui.init({});
		var $$ = jQuery.noConflict();
		var detailInfo = {};
		var teamBillCom;
		var teamBillComName;
		var fbill_no;
		var loginCom;
		var loginComName;
		var userbillNo;
		var userName;
		var privileges;
		var fromPage;
		var deptname;
		mui.plusReady(function() {
			
			window.addEventListener('backAndRefreshList', function(event) {
				teamBillCom 	= event.detail.teamBillCom;		// 管理单位代码
				fbill_no 		= event.detail.fbill_no;		// fbill_no是
				teamBillComName = event.detail.teamBillComName; // 管理单位名称
				loginCom 		= event.detail.loginCom;	 	// 登录单位代码
				loginComName 	= event.detail.loginComName;	// 登录单位名称
				userbillNo 		= event.detail.userbillNo;		// 登录人的代码
				userName 		= event.detail.userName,		// 登录人的姓名
				privileges 		= event.detail.privileges,		// 当前的权限是
				fromPage 		= event.detail.fromPage,		// 从哪个页面来
				bill_no 			= event.detail.bill_no,		// 从哪个页面来
				queryparmas={
					name:'vdvc103',    
					bill_com:loginCom, 
					bill_task:"L,S,Y,YF",
					currentPage:1, 
					pageSize:1, 
					paramText:"",
					bill_no:bill_no  
				}
				searchAjax(queryparmas);
				var queryflow = {
					name: 'msvr',
					bill_task: "VR_query_depthead", // 查询的指令
					bill_com: loginCom, // 当前单位
					bill_user: userbillNo, // 当前登陆人
					bill_no	:bill_no,
					currentPage: 1,
					pageSize: 100,
					paramText: ""
				};
				rqsDataAjax(queryflow, '/Find/Ddata/activity', reportData, '../login.html');
			})
			var oldBack = mui.back;
		    mui.back = function(){
		    	if(fromPage != "vdvc103list" && fromPage != "vdvc103edit"){
		    		oldBack();
		    		return;
		    	}
		    	var webview = plus.webview.getWebviewById("vdvc103_plist.html");
		    	webview.show();
		    }
			// 获取上个页面传过来的参数
			var self = plus.webview.currentWebview();
			// 基本参数(必要)
			teamBillCom 	= self.teamBillCom; 	// 1.管理单位代码
			teamBillComName = self.teamBillComName;	// 2.管理单位名称
			fbill_no 		= self.fbill_no;		// 3.fbill_no是
			loginCom 		= self.loginCom;		// 4.登录单位代码
			loginComName 	= self.loginComName;	// 5.登录单位名称
			userbillNo 		= self.userbillNo;		// 6.登录人的代码
			userName 		= self.userName;		// 7.登录人的姓名
			privileges 		= self.privileges;		// 8.当前的权限是
			fromPage 		= self.fromPage;		// 9.从哪个页面来
			deptname 		= self.deptname;
			

//			if(fromPage=="vdvc103list") {
//				detailInfo = self.detailInfo;
//			}
			if(fromPage=="vdvc103edit") {
				detailInfo = self.rqsData;
				detailInfo.bill_task = "S";
				if((typeof detailInfo.bill_text) == "string"){
					detailInfo.bill_text = JSON.parse(detailInfo.bill_text);
				}
			}else{
				detailInfo = self.detailInfo;
			}
//			setInputValue(detailInfo);
 			
			//
			var date = new Date();
			var commit = document.getElementById("commit");
			var bill_date = vlUtils.dateToString(date);
			var rqsData = null; //提交的数据
			var inputData = null; // 表单里的数据
			
			// 查询该条数据
			if(fromPage == 'vdoa001_node.html'){
				queryparmas={
					name:'vdvc103',    
					bill_com:detailInfo.values.main.bill_com, 
					bill_task:"L,S,Y,YF",
					currentPage:1, 
					pageSize:1, 
					paramText:"",
					bill_no:detailInfo.values.main.bill_no 
				}
				searchAjax(queryparmas);
			}else{
				queryparmas={
					name:'vdvc103',    
					bill_com:detailInfo.bill_com, 
					bill_task:"L,S,Y,YF",
					currentPage:1, 
					pageSize:1, 
					paramText:"",
					bill_no:detailInfo.bill_no  
				}
				searchAjax(queryparmas);
			}
			var queryflow = {
				name: 'msvr',
				bill_task: "VR_query_depthead", // 查询的指令
				bill_com: detailInfo.bill_com, // 当前单位
				bill_user: userbillNo, // 当前登陆人
				bill_no	:detailInfo.bill_no,
				currentPage: 1,
				pageSize: 100,
				paramText: ""
			};
			rqsDataAjax(queryflow, '/Find/Ddata/activity', reportData, '../login.html');
			
			if(detailInfo.bill_task == "L"){
				jQuery("#bBackIcon").addClass("unclickable");
				document.getElementById("bBackBtn").removeEventListener("tap",bBackBtn)
			}else{
				document.getElementById('bBackBtn').addEventListener("tap", bBackBtn);
			}
			
			// 判断权限部门迁移
			document.getElementById("moveDept").addEventListener("tap",function(){
				
				var billUser = document.getElementById("toEdit").getAttribute("billUser");
				var privileges = vlUtils.getStorage("newPrivileges");

				if(billUser == userbillNo || privileges == "ROOT"){
					mui.openWindow({
						url:"vdvc103_edit01.html",
						id :"vdvc103_edit01.html",
						createNew: true,
						extras:{
							teamBillCom 	: teamBillCom, 		// 1.管理单位代码	// 不变
							teamBillComName : teamBillComName,	// 2.管理单位名称	// 不变
							fbill_no 		: fbill_no,			// 3.fbill_no是		// 不变
							loginCom 		: loginCom,			// 4.登录单位代码
							loginComName 	: loginComName,		// 5.登录单位名称
							userbillNo 		: userbillNo,		// 6.登录人的代码
							userName 		: userName,			// 7.登录人的姓名
							privileges 		: privileges,		// 8.当前的权限是
							fromPage 		: "vdvc103node",	// 9.从哪个页面来
							deptname		: deptname,
							detailInfo		: detailInfo
						}
					})	
				}else{
					mui.toast("仅制单人或管理员有此权限！");
				}
			})
			
			// 下级部门开始
			document.getElementById("lowerDept").addEventListener("tap",function(){
 
				teamBillCom 	= detailInfo.bill_no;
				teamBillComName = detailInfo.bill_name;
				fbill_no 		= detailInfo.bill_no;
				
				// 刷新103plist
				mui.fire(plus.webview.getWebviewById('vdvc103_plist.html'),'lowerDeptRefresh103plist',{
                	teamBillCom 	: teamBillCom, 		// 1.管理单位代码 	// 0109改为当前li的bill_no  
					teamBillComName : teamBillComName,	// 2.管理单位名称	// 0109改为当前li的bill_name 
					fbill_no 		: fbill_no,			// 3.fbill_no是		// 0109改为当前li的bill_no 
					loginCom 		: loginCom,			// 4.登录单位代码
					loginComName 	: loginComName,		// 5.登录单位名称
					userbillNo 		: userbillNo,		// 6.登录人的代码
					userName 		: userName,			// 7.登录人的姓名
					privileges 		: privileges,		// 8.当前的权限是
					fromPage 		: "vdvc103node",	// 9.从哪个页面来
                	detailInfo		: detailInfo
                }); 
                
                // 刷新103list
                mui.fire(plus.webview.getWebviewById('vdvc103_list.html'),'lowerDeptRefresh103list',{
                	teamBillCom 	: teamBillCom, 		// 1.管理单位代码 	// 0109改为当前li的bill_no  
					teamBillComName : teamBillComName,	// 2.管理单位名称	// 0109改为当前li的bill_name 
					fbill_no 		: fbill_no,			// 3.fbill_no是		// 0109改为当前li的bill_no 
					loginCom 		: loginCom,			// 4.登录单位代码
					loginComName 	: loginComName,		// 5.登录单位名称
					userbillNo 		: userbillNo,		// 6.登录人的代码
					userName 		: userName,			// 7.登录人的姓名
					privileges 		: privileges,		// 8.当前的权限是
					fromPage 		: "vdvc103node",	// 9.从哪个页面来
                		detailInfo		: detailInfo
                });
                
                // 打开页面
                mui.openWindow({
				    id:'vdvc103_plist.html'
				});
			})

			// 开始用户管理
			document.getElementById('userManage').addEventListener("tap", function() {
				
				teamBillCom 	= detailInfo.bill_no;
				teamBillComName = detailInfo.bill_name;
				fbill_no 		= detailInfo.bill_no;
				
				mui.openWindow({
					url: 'vdvc105_plist.html',
				    id: "vdvc105_plist.html",
				    extras:{
				    	teamBillCom 	: teamBillCom, 		// 1.管理单位代码 	// 0109改为当前li的bill_no  
						teamBillComName : teamBillComName,	// 2.管理单位名称	// 0109改为当前li的bill_name 
						fbill_no 		: fbill_no,			// 3.fbill_no是		// 0109改为当前li的bill_no 
						loginCom 		: loginCom,			// 4.登录单位代码
						loginComName 	: loginComName,		// 5.登录单位名称
						userbillNo 		: userbillNo,		// 6.登录人的代码
						userName 		: userName,			// 7.登录人的姓名
						privileges 		: privileges,		// 8.当前的权限是
						fromPage 		: "vdvc103node",	// 9.从哪个页面来	// 0109之前为103_juese，后为103node
						detailInfo		: detailInfo,
						business		: "103"
					} 
				})
			},false)
			document.getElementById('CRM').addEventListener("tap", function() {
				
				teamBillCom 	= detailInfo.bill_no;
				teamBillComName = detailInfo.bill_name;
				fbill_no 		= detailInfo.bill_no;
				
				mui.openWindow({
					url:'vdvc312_plist.html',
				    id: "vdvc312_plist.html",
				    extras:{
				    	teamBillCom 	: teamBillCom, 		// 1.管理单位代码 	// 0109改为当前li的bill_no  
						teamBillComName : teamBillComName,	// 2.管理单位名称	// 0109改为当前li的bill_name 
						fbill_no 		: fbill_no,			// 3.fbill_no是		// 0109改为当前li的bill_no 
						loginCom 		: loginCom,			// 4.登录单位代码
						loginComName 	: loginComName,		// 5.登录单位名称
						userbillNo 		: userbillNo,		// 6.登录人的代码
						userName 		: userName,			// 7.登录人的姓名
						privileges 		: privileges,		// 8.当前的权限是
						fromPage 		: "vdvc103node",	// 9.从哪个页面来	// 0109之前为103_juese，后为103node
						detailInfo		: detailInfo,
						business		: "103",
						fbillnoName 	: teamBillComName
					} 
				})
			},false)
			// 点击返回按钮
//			document.getElementById("goBack").addEventListener("tap", function() {
//			    var oldBack = mui.back;
//			    mui.back = function(){
//			    	var webview = plus.webview.getWebviewById('vdvc103_plist.html');
//			    	webview.show();
//			    }
//			    mui.back();
//			});
			// 收回指令
			
			function bBackBtn(){ 
				var date = new Date();
				var params = JSON.parse(JSON.stringify(sendTaskData));
				params.bill_com	 = loginCom;
				params.fbill_no	 = detailInfo.fbill_no;
				params.bill_no 	 = detailInfo.bill_no;
				params.bill_user = userbillNo;
				params.bill_date = vlUtils.dateToString(date);
				params.bill_task = "b_back";
				CRUDajax(params,'../login.html',reloadnode)
			}
			function reloadnode(){
//				successFun("vdvc103_node.html"); // 重载会载错页面
				if(fromPage == 'vdoa001_node.html'){
					queryparmas={
						name:'vdvc103',    
						bill_com:detailInfo.bill_com, 
						bill_task:"L,S,Y,YF",
						currentPage:1, 
						pageSize:1, 
						paramText:"",
						bill_no:detailInfo.oppo  
					}
					searchAjax(queryparmas);
				}else{
					queryparmas={
						name:'vdvc103',    
						bill_com:detailInfo.bill_com, 
						bill_task:"L,S,Y,YF",
						currentPage:1, 
						pageSize:1, 
						paramText:"",
						bill_no:detailInfo.bill_no  
					}
					searchAjax(queryparmas);
				}
			}
			// 点击编辑
			document.getElementById("toEdit").addEventListener("tap",function(){
				var billUser = document.getElementById("toEdit").getAttribute("billUser");
				var privileges = vlUtils.getStorage("newPrivileges");
//				if(detailInfo.bill_task != "L"){
//					mui.toast("单据已经送审或者正在送审中，不支持编辑！\n若想编辑请先收回！")
//					return;
//				}
				if(billUser == userbillNo || privileges == "ROOT"){
					mui.openWindow({
						url: 'vdvc103_edit.html',
						id: "vdvc103_edit.html",
					    createNew:true,
					    extras:{
					    	teamBillCom 	: teamBillCom, 		// 1.管理单位代码 	// 不变 
							teamBillComName : teamBillComName,	// 2.管理单位名称	// 不变 
							fbill_no 		: fbill_no,			// 3.fbill_no是		// 不变
							loginCom 		: loginCom,			// 4.登录单位代码
							loginComName 	: loginComName,		// 5.登录单位名称
							userbillNo 		: userbillNo,		// 6.登录人的代码
							userName 		: userName,			// 7.登录人的姓名
							privileges 		: privileges,		// 8.当前的权限是
							fromPage 		: "vdvc103node",	// 9.从哪个页面来
							detailInfo 		: detailInfo,
 							flagNew 		: "N"
						} 
					})
				}else{
					mui.toast("仅制单人或管理员有此权限！");
				}
			});
			// 编辑结束
			// 发送信息开始
			document.getElementById("chatBtn").addEventListener("tap",function(){
				return; // 客户版本需要放开

				var billUser = document.getElementById("toEdit").getAttribute("billUser");
				var privileges = vlUtils.getStorage("newPrivileges");
				if(billUser == userbillNo || privileges == "ROOT"){
//					var vdim102 = plus.webview.getWebviewById('vdim102_list.html');
					mui.openWindow({
						url: '../vlvdim/vdim102_list.html',
						id: "vdim102_list.html",
					    createNew:true,
					    extras:{
					    	teamBillCom 	: teamBillCom, 		// 1.管理单位代码 	// ？？ 0109改为当前li的bill_no  
							teamBillComName : teamBillComName,	// 2.管理单位名称	// ？？ 0109改为当前li的bill_name 
							fbill_no 		: fbill_no,			// 3.fbill_no是		// ？？ 0109改为当前li的bill_no 
							loginCom 		: loginCom,			// 4.登录单位代码
							loginComName 	: loginComName,		// 5.登录单位名称
							userbillNo 		: userbillNo,		// 6.登录人的代码
							userName 		: userName,			// 7.登录人的姓名
							privileges 		: privileges,		// 8.当前的权限是
							fromPage 		: "vdvc103node",	// 9.从哪个页面来
							fsend_group		: detailInfo.bill_no,
							chatMen			: detailInfo.bill_name,
 							flagNew 		: "N"
						} 
					})
				}else{
					mui.toast("仅制单人或管理员有此权限！");
				}
			});
			// 发送信息结束
			// 变更负责人
			document.getElementById("changeUser").addEventListener("tap", function() {
				//触发详情页面的newsId事件
				var oldLinkuser = document.getElementById("linkvd_linkuser").innerHTML;
				var oldLinktel = document.getElementById("linkbd_linktel").innerHTML;
				var oldLinkid = document.getElementById("linkbd_linkid").innerHTML;
				mui.openWindow({
					url: 'vdvc103_edit03.html',
					id: 'vdvc103_edit03.html',
					createNew: true,
					extras: {
//						oldUserName		: oldUserName,
//						oldUserCode		: oldUserCode,
						oldLinkuser 	: oldLinkuser, 		// 1.管理单位代码 	// ？？ 0109改为当前li的bill_no
						oldLinktel 		: oldLinktel, 		// 1.管理单位代码 	// ？？ 0109改为当前li的bill_no
						oldLinkid 		: oldLinkid, 		// 1.管理单位代码 	// ？？ 0109改为当前li的bill_no
						teamBillCom 	: teamBillCom, 		// 1.管理单位代码 	// ？？ 0109改为当前li的bill_no
						teamBillComName : teamBillComName,	// 2.管理单位名称	// ？？ 0109改为当前li的bill_name 
						fbill_no 		: fbill_no,			// 3.fbill_no是		// ？？ 0109改为当前li的bill_no 
						loginCom 		: loginCom,			// 4.登录单位代码
						loginComName 	: loginComName,		// 5.登录单位名称
						userbillNo 		: userbillNo,		// 6.登录人的代码
						userName 		: userName,			// 7.登录人的姓名
						privileges 		: privileges,		// 8.当前的权限是
						fromPage 		: "vdvc103_edit.html",	// 9.从哪个页面来
						detailInfo 		: detailInfo
					}
				})
			}) 
			// 抄送
			document.getElementById("cc").addEventListener("tap", function() {
				//触发详情页面的newsId事件
				var oldUserName = document.getElementById("cc_user_cn").innerHTML;
				var oldUserCode = document.getElementById("cc_user_code").innerHTML;
				mui.openWindow({
					url: 'vdvc103_edit02.html',
					id: 'vdvc103_edit02.html',
					createNew: true,
					extras: {
						oldUserName		: oldUserName,
						oldUserCode		: oldUserCode,
						teamBillCom 	: teamBillCom, 		// 1.管理单位代码 	// ？？ 0109改为当前li的bill_no  
						teamBillComName : teamBillComName,	// 2.管理单位名称	// ？？ 0109改为当前li的bill_name 
						fbill_no 		: fbill_no,			// 3.fbill_no是		// ？？ 0109改为当前li的bill_no 
						loginCom 		: loginCom,			// 4.登录单位代码
						loginComName 	: loginComName,		// 5.登录单位名称
						userbillNo 		: userbillNo,		// 6.登录人的代码
						userName 		: userName,			// 7.登录人的姓名
						privileges 		: privileges,		// 8.当前的权限是
						fromPage 		: "vdvc103_edit.html",	// 9.从哪个页面来
						detailInfo 		: detailInfo
					}
				})
			}) 
			//*****************************************************
			function searchAjax(queryparmas) {
				mui.ajax(systemURL + 'Find/Ddata/find', {
					data:queryparmas,
					beforeSend: function() {
						var network = true;
						checkNetState(); // 检查网络链接状态
					},
					dataType: 'json', //服务器返回json格式数据
					type: 'post', //HTTP请求类型
					timeout: 60000, //超时时间设置为10秒；
//					contentType: "application/x-www-form-urlencoded; charset=utf-8",
					contentType: "application/json;charset=utf-8",
					success: function(data) {

						if(data.code == 0) {
							var datas = data.data;
							detailInfo = datas[0];
							if(datas.length != 0) {
								setInputValue(datas[0]);
							   	// 赋值结束
							} else {
								mui.toast("未查询到数据");
							}
						}
						if(data.code == 1) {
							ajaxCode1(data.error_code,data.error_description,'../login.html');
						}
					},
					error: function(xhr, type, errorThrown) {
						console.log(xhr.responseText);
						console.log(errorThrown);
						console.log(type);
					}
				});
			}

			// 数据填空
			function setInputValue(data){  // datas为
				document.getElementById("header").innerHTML 		 = data.bill_name;
				// 给每个输入框赋值
				document.getElementById('bill_name').innerHTML 		 = data.bill_name; //部门名称
				document.getElementById('bill_title').innerHTML 	 = data.bill_title; //部门名称
				document.getElementById('bill_bflow').innerHTML  	 = data.bill_bflow ?  data.bill_bflow : data.link_next; //部门类别
				document.getElementById('bill_id').innerHTML 		 = data.bill_id; // 部门编码
				document.getElementById('bill_label').innerHTML 	 = data.bill_label; // 部门编码
				document.getElementById('fbill_no').innerHTML 		 = data.fbill_no; // 上级部门
				document.getElementById('fbill_no_name').innerHTML 	 = teamBillComName; // 上级部门
				document.getElementById('linkvd_linkuser').innerHTML = data.bill_text[0].linkvd_linkuser; //负责人手机号
				document.getElementById('linkbd_linktel').innerHTML	 = data.bill_text[0].linkbd_linktel; //负责人
//				document.getElementById('linkbd_linkid').innerHTML	 = data.bill_text[0].linkbd_linkid; //负责人
				if (detailInfo.bill_text[0].linkbd_linksts){
					document.getElementById('linkbd_linksts').innerHTML	= data.bill_text[0].linkbd_linksts; 
				}else{
					document.getElementById('linkbd_linksts').innerHTML = "未关联"; 
				}
				if (detailInfo.bill_text[0].linkbd_linkid){
					document.getElementById('linkbd_linkid').innerHTML	= data.bill_text[0].linkbd_linkid; 
					document.getElementById('linkuser').innerHTML	 	= data.bill_text[0].linkvd_linkuser; //负责人
				}else{
					document.getElementById('linkbd_linkid').innerHTML	= ""; 
					document.getElementById('linkuser').innerHTML	 	= ""; //负责人
				}
				// 存
				vlUtils.setStorage("preDept",data.fbill_no);
				vlUtils.setStorage("preDeptName",data.bill_name);
				// 管理员、业务员
				document.getElementById("bill_user").innerHTML 		= data.bill_user;
				document.getElementById("bill_userName").innerHTML 	= data.bill_userName;
//				document.getElementById("cc_user").innerHTML = data.bill_text[0].cc_user_cn;
//				document.getElementById("cc_user").innerHTML 		= data.cc_user;
				document.getElementById("bill_date").innerHTML 		= data.bill_date;
				// 编辑按钮权限判断
				document.getElementById("toEdit").setAttribute("billUser",data.bill_user);
				// 处理状态
				if(data.bill_task == "S") {
					jQuery("#bBackIcon").removeClass("unclickable");
					document.getElementById("bBackBtn").removeEventListener("tap",bBackBtn)
					document.getElementById("bill_task").innerHTML = "待审核";
				}
				if(data.bill_task == "Y") {
					jQuery("#bBackIcon").removeClass("unclickable");
					document.getElementById("bBackBtn").addEventListener("tap",bBackBtn)
					document.getElementById("bill_task").innerHTML = "已审核";
				}
				if(data.bill_task == "L"){
					jQuery("#bBackIcon").addClass("unclickable");
					document.getElementById("bBackBtn").removeEventListener("tap",bBackBtn)
					document.getElementById("bill_task").innerHTML = "待送审";
				}

				// 下载图片
				var imgid= vlUtils.uuid('img', 4, 10);
			 	$$("#userImg").attr('id',imgid);	
		 	    //判断有值的话拿到用户的id然后请求小图标
			    if(!vlUtils.isnull(data["bill_no"])){
			    		vlUtils.downloadicon(data["bill_no"],imgid);
			   	};
			   	// 抄送
			   	//
				var ccUserJson = detailInfo.cc_user;

 				if(!vlUtils.isnull(ccUserJson)){
 					var ccUserNameStr = "";
					var ccUserCodeStr = "";
					// 遍历对象，取出里面的中文名放在页面上
					for(var i in ccUserJson) {
						ccUserNameStr += "," + ccUserJson[i];
						ccUserCodeStr += "," + i;
					}
					document.getElementById("cc_user_code").innerHTML = ccUserCodeStr.slice(1);
					document.getElementById("cc_user_cn").innerHTML = ccUserNameStr.slice(1);
 				}else{
 					document.getElementById("cc_user_code").innerHTML = "";
					document.getElementById("cc_user_cn").innerHTML = "";
 				}
			}
				// TODO 发送ajax
		function reportData(data, type) {
			var dataInfo = [];
			if(data.data.length != 0) {
				var text = '';
				for(var i = 0; i < data.data.length; i++) {
					var newdataArr = {};
					for(var k in data.data[i]) {
						newdataArr[k.slice(0, 2)] = data.data[i][k];
					}
					dataInfo.push(newdataArr);
				}
				document.getElementById('linkbd_linkid').innerHTML = dataInfo[0]["图片"];
				document.getElementById('linkuser').innerHTML = dataInfo[0]["标题"];
			} else{}
		}
		}); // plusReady
	</script>

</html>